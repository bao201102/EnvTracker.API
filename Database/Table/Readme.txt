CREATE DATABASE "EnvTracker"
    WITH
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'English_United States.1252'
    LC_CTYPE = 'English_United States.1252'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1
    IS_TEMPLATE = False;
	
////////////////////////////////////////////////////////////////////////////////////////

CREATE SCHEMA IF NOT EXISTS usr
    AUTHORIZATION postgres;

CREATE SCHEMA IF NOT EXISTS sta
    AUTHORIZATION postgres;
	
////////////////////////////////////////////////////////////////////////////////////////

CREATE TABLE IF NOT EXISTS usr.user
(
    "user_id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "user_name" varchar(50) NOT NULL,
    "first_name" varchar(50) NULL,
    "last_name" varchar(30) NULL,
    "phone" varchar(15) NULL,
    "email" varchar(100) NULL,
    "password" varchar(128) NOT NULL,
    "activation_code" varchar(50) NULL,
    "role_id" integer NOT NULL DEFAULT 2,
    "last_password_change_date" timestamp NOT NULL DEFAULT now(),
    "last_activity_date" timestamp NOT NULL DEFAULT now(),
    "last_login_date" timestamp NOT NULL DEFAULT now(),
    "last_lockout_date" timestamp,
    "is_locked_out" boolean NOT NULL DEFAULT false,
    "is_approved" boolean NOT NULL DEFAULT false,
    "comment" varchar(200) NULL,
    "created_date" timestamp NOT NULL DEFAULT now(),
    "updated_date" timestamp NOT NULL DEFAULT now(),
	"is_deleted" boolean NOT NULL DEFAULT false,
    CONSTRAINT "user_pkey" PRIMARY KEY ("user_id")
)
	
CREATE TABLE IF NOT EXISTS usr.role
(
    "role_id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "role_name" varchar(50) NOT NULL,
    "created_date" timestamp NOT NULL DEFAULT now(),
    "updated_date" timestamp NOT NULL DEFAULT now(),
	"is_deleted" boolean NOT NULL DEFAULT false,
    CONSTRAINT "role_pkey" PRIMARY KEY ("role_id")
)

CREATE TABLE IF NOT EXISTS sta.station
(
    "station_id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "name" varchar(128) NOT NULL,
    "address" varchar(256) NULL,
    "latitude" float8 NOT NULL,
    "longtitude" float8 NOT NULL,
    "is_active" boolean NOT NULL DEFAULT true,
    "is_sms_alert_enable" boolean NOT NULL DEFAULT false,
    "sms_alert_phone_number" varchar(15) NULL,
    "param" varchar(256) NULL,
	"sensor_ids" int[] NULL,
    "created_date" timestamp NOT NULL DEFAULT now(),
    "updated_date" timestamp NOT NULL DEFAULT now(),
	"is_deleted" boolean NOT NULL DEFAULT false,
    CONSTRAINT "station_pkey" PRIMARY KEY ("station_id")
)
	
CREATE TABLE IF NOT EXISTS sta.sensor
(
    "sensor_id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "name" varchar(128) NOT NULL,
    "upper_bound" float8 NULL,
    "lower_bound" float8 NULL,
    "differ_bound" float8 NULL,
    "unit_symbol" varchar(50) NULL,
    "is_active" boolean NOT NULL DEFAULT true,
    "param" varchar(256) NULL,
    "created_date" timestamp NOT NULL DEFAULT now(),
    "updated_date" timestamp NOT NULL DEFAULT now(),
	"is_deleted" boolean NOT NULL DEFAULT false,
    CONSTRAINT "sensor_pkey" PRIMARY KEY ("sensor_id")
)

CREATE TABLE IF NOT EXISTS sta.sensor_value
(
    "sensor_value_id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "value" float8 NOT NULL,
    "sensor_id" integer NOT NULL,
    "station_id" integer NOT NULL,
    "value_time_id" integer NOT NULL,
    "created_date" timestamp NOT NULL DEFAULT now(),
    "updated_date" timestamp NOT NULL DEFAULT now(),
	"is_deleted" boolean NOT NULL DEFAULT false,
    CONSTRAINT "sensor_value_pkey" PRIMARY KEY ("sensor_value_id")
)

CREATE TABLE IF NOT EXISTS sta.value_time
(
    "value_time_id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "time" int8 NOT NULL,
    "station_id" integer NOT NULL,
    "created_date" timestamp NOT NULL DEFAULT now(),
    "updated_date" timestamp NOT NULL DEFAULT now(),
	"is_deleted" boolean NOT NULL DEFAULT false,
    CONSTRAINT "value_time_pkey" PRIMARY KEY ("value_time_id")
)

CREATE TABLE IF NOT EXISTS usr.permission
(
    "permission_id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "group" integer NULL,
    "action" integer NULL,
    "created_date" timestamp NOT NULL DEFAULT now(),
    "updated_date" timestamp NOT NULL DEFAULT now(),
	"is_deleted" boolean NOT NULL DEFAULT false,
    CONSTRAINT "permission_pkey" PRIMARY KEY ("permission_id")
)

CREATE TABLE IF NOT EXISTS public.activity_log
(
    "activity_log_id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "user_id" integer NOT NULL,
    "context" varchar(100) NULL,
	"action" varchar(100) NULL,
	"message" varchar(200) NULL,
    "created_date" timestamp NOT NULL DEFAULT now(),
    "updated_date" timestamp NOT NULL DEFAULT now(),
	"is_deleted" boolean NOT NULL DEFAULT false,
    CONSTRAINT "activity_log_pkey" PRIMARY KEY ("activity_log_id")
)
